import assertRevert, { assertError } from '../helpers/assertRevert'

const BigNumber = web3.BigNumber

const Heritage = artifacts.require('Heritage')

require('chai')
  .use(require('chai-as-promised'))
  .use(require('chai-bignumber')(BigNumber))
  .should()

const expect = require('chai').expect

contract('Heritage', accounts => {
  const [creator, donor1, donor2, donor3, donor4] = accounts
  const charity = "0x4f403d6dc030eb171f60d990840de3ac4527215f";
  const taxId = '46-0192831';
  let notary = null
  const donationsToCreate = 5;
  const zeroAddress = "0x0000000000000000000000000000000000000000";
  const genesisDonationName = "Genesis Donation";
  const oneEther = 10e17;

  beforeEach(async () => {
    notary = await Heritage.new(true)
    await notary.createDonation(`Campaign-2`, 10e18, charity, taxId)
  })

  describe('Tests', () => {
    describe('Heritage', async () => {
      it('Deployment cost', async() => {
        // ~20Kb deployed bytecode
        console.log(web3.eth.estimateGas({ data: "0x60806040526004361061023a5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166301e93bfd811461024957806301ffc9a71461027057806306fdde03146102be578063081812fc14610348578063095ea7b31461037c5780630967e9b1146103a257806317ffc320146103c057806319fa8f50146103e157806323b872dd1461042b5780632aed7f3f146104555780632d06177a146104765780633f4ba83a1461049757806342842e0e146104ac5780634f558e79146104d65780635c975abb146104ee5780636352211e1461050357806370a082311461051b578063715018a61461053c578063718841361461055157806383197ef0146106b0578063834cb5f7146106c55780638456cb59146106da5780638da5cb5b146106ef5780638f2ccfba1461070457806395d89b41146107435780639ada911b146107585780639f727c271461079b578063a22cb465146107b0578063ac18de43146107d6578063b6acb66c146107f7578063b7411138146108b6578063b88d4fde146108cb578063c0ee0b8a1461093a578063c5c4744c1461096b578063de2ed89314610980578063e985e9c514610995578063edf5deb9146109bc578063f2bdc36a146109d1578063f2ef680c146109ef578063f2fde38b14610a0d578063f3ae241514610a2e578063f5074f4114610a4f578063f5be319314610a70578063f6e68ccf14610a85578063f8626af814610a96578063fc8d6bfe14610aed578063ff284f7c14610b0b575b34801561024657600080fd5b50005b34801561025557600080fd5b5061025e610b29565b60408051918252519081900360200190f35b34801561027c57600080fd5b506102aa7fffffffff0000000000000000000000000000000000000000000000000000000060043516610b55565b604080519115158252519081900360200190f35b3480156102ca57600080fd5b506102d3610b8c565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561030d5781810151838201526020016102f5565b50505050905090810190601f16801561033a5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561035457600080fd5b50610360600435610bc3565b60408051600160a060020a039092168252519081900360200190f35b34801561038857600080fd5b506103a0600160a060020a0360043516602435610bde565b005b3480156103ae57600080fd5b506102d363ffffffff60043516610c94565b3480156103cc57600080fd5b506103a0600160a060020a0360043516610d2f565b3480156103ed57600080fd5b506103f6610dfb565b604080517fffffffff000000000000000000000000000000000000000000000000000000009092168252519081900360200190f35b34801561043757600080fd5b506103a0600160a060020a0360043581169060243516604435610e1f565b34801561046157600080fd5b506103a0600160a060020a0360043516610ec4565b34801561048257600080fd5b506103a0600160a060020a0360043516610f5e565b3480156104a357600080fd5b506103a0610fd1565b3480156104b857600080fd5b506103a0600160a060020a0360043581169060243516604435611062565b3480156104e257600080fd5b506102aa60043561109a565b3480156104fa57600080fd5b506102aa6110b7565b34801561050f57600080fd5b506103606004356110d8565b34801561052757600080fd5b5061025e600160a060020a0360043516611102565b34801561054857600080fd5b506103a0611135565b34801561055d57600080fd5b5061056f63ffffffff600435166111a1565b6040805163ffffffff808c1682528a166020808301919091526fffffffffffffffffffffffffffffffff808a1660608401528881166080840152871660a0830152600160a060020a0380871660c0840152851660e08301526101209282018381528a51938301939093528951919291610100840191610140850191908c019080838360005b8381101561060c5781810151838201526020016105f4565b50505050905090810190601f1680156106395780820380516001836020036101000a031916815260200191505b50838103825284518152845160209182019186019080838360005b8381101561066c578181015183820152602001610654565b50505050905090810190601f1680156106995780820380516001836020036101000a031916815260200191505b509b50505050505050505050505060405180910390f35b3480156106bc57600080fd5b506103a06113f4565b3480156106d157600080fd5b5061025e611419565b3480156106e657600080fd5b506103a061144b565b3480156106fb57600080fd5b506103606114f2565b34801561071057600080fd5b5061025e63ffffffff600435166fffffffffffffffffffffffffffffffff60243516600160a060020a0360443516611501565b34801561074f57600080fd5b506102d36115d4565b34801561076457600080fd5b5061077663ffffffff6004351661160b565b604080516fffffffffffffffffffffffffffffffff9092168252519081900360200190f35b3480156107a757600080fd5b506103a061162f565b3480156107bc57600080fd5b506103a0600160a060020a03600435166024351515611684565b3480156107e257600080fd5b506103a0600160a060020a0360043516611708565b34801561080357600080fd5b506040805160206004803580820135601f810184900484028501840190955284845261025e94369492936024939284019190819084018382808284375050604080516020888301358a018035601f8101839004830284018301909452838352979a89356fffffffffffffffffffffffffffffffff169a8a830135600160a060020a03169a919990985060609091019650919450908101925081908401838280828437509497506117779650505050505050565b3480156108c257600080fd5b5061025e6117db565b3480156108d757600080fd5b50604080516020601f6064356004818101359283018490048402850184019095528184526103a094600160a060020a0381358116956024803590921695604435953695608494019181908401838280828437509497506117f39650505050505050565b34801561094657600080fd5b506103a060048035600160a060020a0316906024803591604435918201910135611832565b34801561097757600080fd5b50610776611837565b34801561098c57600080fd5b5061077661184f565b3480156109a157600080fd5b506102aa600160a060020a036004358116906024351661187b565b3480156109c857600080fd5b506102aa6118a9565b3480156109dd57600080fd5b5061077663ffffffff600435166118b2565b3480156109fb57600080fd5b5061036063ffffffff600435166118d6565b348015610a1957600080fd5b506103a0600160a060020a03600435166118f1565b348015610a3a57600080fd5b506102aa600160a060020a0360043516611911565b348015610a5b57600080fd5b506103a0600160a060020a036004351661192f565b348015610a7c57600080fd5b50610776611952565b61025e63ffffffff6004351661196a565b348015610aa257600080fd5b50610aae600435611bc7565b6040805163ffffffff90941684526fffffffffffffffffffffffffffffffff9092166020840152600160a060020a031682820152519081900360600190f35b348015610af957600080fd5b506102d363ffffffff60043516611c1e565b348015610b1757600080fd5b506103a063ffffffff60043516611c86565b60085470010000000000000000000000000000000090046fffffffffffffffffffffffffffffffff1690565b7fffffffff000000000000000000000000000000000000000000000000000000001660009081526002602052604090205460ff1690565b60408051808201909152600881527f4865726974616765000000000000000000000000000000000000000000000000602082015290565b600090815260046020526040902054600160a060020a031690565b6000610be9826110d8565b9050600160a060020a038381169082161415610c0457600080fd5b33600160a060020a0382161480610c205750610c20813361187b565b1515610c2b57600080fd5b600082815260046020526040808220805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0387811691821790925591518593918516917f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92591a4505050565b600b6020908152600091825260409182902080548351601f600260001961010060018616150201909316929092049182018490048402810184019094528084529091830182828015610d275780601f10610cfc57610100808354040283529160200191610d27565b820191906000526020600020905b815481529060010190602001808311610d0a57829003601f168201915b505050505081565b60008054600160a060020a03163314610d4757600080fd5b604080517f70a082310000000000000000000000000000000000000000000000000000000081523060048201529051600160a060020a038416916370a082319160248083019260209291908290030181600087803b158015610da857600080fd5b505af1158015610dbc573d6000803e3d6000fd5b505050506040513d6020811015610dd257600080fd5b5051600054909150610df790600160a060020a0384811691168363ffffffff611daa16565b5050565b7f01ffc9a70000000000000000000000000000000000000000000000000000000081565b80610e2a3382611e62565b1515610e3557600080fd5b600160a060020a0384161515610e4a57600080fd5b600160a060020a0383161515610e5f57600080fd5b610e698483611eb9565b610e738483611f28565b610e7d8383611fbe565b8183600160a060020a031685600160a060020a03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a450505050565b60008054600160a060020a03163314610edc57600080fd5b5060008054604080517ff2fde38b000000000000000000000000000000000000000000000000000000008152600160a060020a039283166004820152905184939284169263f2fde38b926024808201939182900301818387803b158015610f4257600080fd5b505af1158015610f56573d6000803e3d6000fd5b505050505050565b600054600160a060020a03163314610f7557600080fd5b600160a060020a038116600081815260016020818152604092839020805460ff1916909217909155815192835290517f3630096a7f9a158ab9fae41e86bfe31fd2202585a26a9668242672566dae028d9281900390910190a150565b600054600160a060020a03163314610fe857600080fd5b60005474010000000000000000000000000000000000000000900460ff16151561101157600080fd5b600080547fffffffffffffffffffffff00ffffffffffffffffffffffffffffffffffffffff1681556040517f7805862f689e2f13df9f062ff482ad3ad112aca9e0847911ed832e158c525b339190a1565b8061106d3382611e62565b151561107857600080fd5b61109484848460206040519081016040528060008152506117f3565b50505050565b600090815260036020526040902054600160a060020a0316151590565b60005474010000000000000000000000000000000000000000900460ff1681565b600081815260036020526040812054600160a060020a03168015156110fc57600080fd5b92915050565b6000600160a060020a038216151561111957600080fd5b50600160a060020a031660009081526005602052604090205490565b600054600160a060020a0316331461114c57600080fd5b60008054604051600160a060020a03909116917ff8df31144d9c2f0f6b59d69b8b98abd5459d07f2742c4df920b25aae33c6482091a26000805473ffffffffffffffffffffffffffffffffffffffff19169055565b600080606060008060008060006060600060078b63ffffffff168154811015156111c757fe5b600091825260208083206002928302015463ffffffff16808452600a8252604093849020805485516101006001831615026000190190911694909404601f8101849004840285018401909552848452909d508e9c508d94509192908301828280156112735780601f1061124857610100808354040283529160200191611273565b820191906000526020600020905b81548152906001019060200180831161125657829003601f168201915b5050505063ffffffff8381166000908152600d6020908152604080832054600e9092529091205460078054959d506fffffffffffffffffffffffffffffffff9283169c509116995092908e16915081106112c957fe5b600091825260208083206002929092029091015463ffffffff8481168452600c909252604090922054600780546401000000009094046fffffffffffffffffffffffffffffffff169850600160a060020a03909116965091908d1690811061132d57fe5b6000918252602080832060029283020160019081015463ffffffff86168552600b8352604094859020805486516101009482161594909402600019011694909404601f8101849004840283018401909552848252600160a060020a0316965092908301828280156113df5780601f106113b4576101008083540402835291602001916113df565b820191906000526020600020905b8154815290600101906020018083116113c257829003601f168201915b50505050509150509193959799909294969850565b600054600160a060020a0316331461140b57600080fd5b600054600160a060020a0316ff5b6008546007547001000000000000000000000000000000009091046fffffffffffffffffffffffffffffffff16900390565b600054600160a060020a0316331461146257600080fd5b60005474010000000000000000000000000000000000000000900460ff161561148a57600080fd5b600080547fffffffffffffffffffffff00ffffffffffffffffffffffffffffffffffffffff16740100000000000000000000000000000000000000001781556040517f6985a02210a168e66602d3235cb6db0e70f92b3ba4d376a33c0f3d9434bff6259190a1565b600054600160a060020a031681565b33600090815260016020526040812054819060ff16151561152157600080fd5b600f5460ff16151561153257600080fd5b60005474010000000000000000000000000000000000000000900460ff161561155a57600080fd5b600063ffffffff86161161156d57600080fd5b60075463ffffffff86161061158157600080fd5b60075463ffffffff1161159357600080fd5b6007805463ffffffff87169081106115a757fe5b600091825260209091206002909102015463ffffffff1690506115cb81858561204f565b95945050505050565b60408051808201909152600381527f415e330000000000000000000000000000000000000000000000000000000000602082015290565b600d602052600090815260409020546fffffffffffffffffffffffffffffffff1681565b600054600160a060020a0316331461164657600080fd5b60008054604051600160a060020a0390911691303180156108fc02929091818181858888f19350505050158015611681573d6000803e3d6000fd5b50565b600160a060020a03821633141561169a57600080fd5b336000818152600660209081526040808320600160a060020a03871680855290835292819020805460ff1916861515908117909155815190815290519293927f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31929181900390910190a35050565b600054600160a060020a0316331461171f57600080fd5b600160a060020a038116600081815260016020908152604091829020805460ff19169055815192835290517f1e25ed4cabec84d314dc176241019653f237da01f2bdd3a10cb0f38b33da67639281900390910190a150565b3360009081526001602052604081205460ff16151561179557600080fd5b60005474010000000000000000000000000000000000000000900460ff16156117bd57600080fd5b60075463ffffffff116117cf57600080fd5b6115cb8585858561218f565b6009546fffffffffffffffffffffffffffffffff1690565b816117fe3382611e62565b151561180957600080fd5b611814858585610e1f565b6118208585858561236c565b151561182b57600080fd5b5050505050565b600080fd5b6008546fffffffffffffffffffffffffffffffff1681565b60085470010000000000000000000000000000000090046fffffffffffffffffffffffffffffffff1681565b600160a060020a03918216600090815260066020908152604080832093909416825291909152205460ff1690565b600f5460ff1681565b600e602052600090815260409020546fffffffffffffffffffffffffffffffff1681565b600c60205260009081526040902054600160a060020a031681565b600054600160a060020a0316331461190857600080fd5b611681816124f1565b600160a060020a031660009081526001602052604090205460ff1690565b600054600160a060020a0316331461194657600080fd5b80600160a060020a0316ff5b6009546fffffffffffffffffffffffffffffffff1681565b600080548190819074010000000000000000000000000000000000000000900460ff161561199757600080fd5b600034116119a457600080fd5b600063ffffffff8516116119b757600080fd5b60075463ffffffff8516106119cb57600080fd5b60075463ffffffff116119dd57600080fd5b6007805463ffffffff86169081106119f157fe5b6000918252602080832060029092029091015463ffffffff16808352600c909152604090912054909250600160a060020a03161515611a2f57600080fd5b63ffffffff82166000908152600d60205260408120546fffffffffffffffffffffffffffffffff161115611a9f5763ffffffff82166000908152600d6020908152604080832054600e909252909120546fffffffffffffffffffffffffffffffff918216911610611a9f57600080fd5b503463ffffffff82811690851614611af85763ffffffff84166000908152600e6020526040902080546fffffffffffffffffffffffffffffffff8082168401166fffffffffffffffffffffffffffffffff199091161790555b63ffffffff82166000908152600c6020526040808220549051600160a060020a03909116916fffffffffffffffffffffffffffffffff841680156108fc02929091818181858888f19350505050158015611b56573d6000803e3d6000fd5b5063ffffffff82166000908152600e6020526040902080546fffffffffffffffffffffffffffffffff198082166fffffffffffffffffffffffffffffffff9283168501831617909255600880549283169282168401909116919091179055611bbf82823361256e565b949350505050565b6007805482908110611bd557fe5b60009182526020909120600290910201805460019091015463ffffffff821692506401000000009091046fffffffffffffffffffffffffffffffff1690600160a060020a031683565b600a6020908152600091825260409182902080548351601f600260001961010060018616150201909316929092049182018490048402810184019094528084529091830182828015610d275780601f10610cfc57610100808354040283529160200191610d27565b600054600160a060020a03163314611c9d57600080fd5b6007805463ffffffff8316908110611cb157fe5b600091825260208083206002909202909101805473ffffffffffffffffffffffffffffffffffffffff1990811682556001909101805490911690556040805180830180835284825263ffffffff86168552600a90935292209151611d16929190612761565b50604080516020818101808452600080845263ffffffff86168152600b9092529290209051611d459290612761565b5063ffffffff166000908152600c60209081526040808320805473ffffffffffffffffffffffffffffffffffffffff19169055600d825280832080546fffffffffffffffffffffffffffffffff19908116909155600e90925290912080549091169055565b82600160a060020a031663a9059cbb83836040518363ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018083600160a060020a0316600160a060020a0316815260200182815260200192505050602060405180830381600087803b158015611e2657600080fd5b505af1158015611e3a573d6000803e3d6000fd5b505050506040513d6020811015611e5057600080fd5b50511515611e5d57600080fd5b505050565b600080611e6e836110d8565b905080600160a060020a031684600160a060020a03161480611ea9575083600160a060020a0316611e9e84610bc3565b600160a060020a0316145b80611bbf5750611bbf818561187b565b81600160a060020a0316611ecc826110d8565b600160a060020a031614611edf57600080fd5b600081815260046020526040902054600160a060020a031615610df7576000908152600460205260409020805473ffffffffffffffffffffffffffffffffffffffff1916905550565b81600160a060020a0316611f3b826110d8565b600160a060020a031614611f4e57600080fd5b600160a060020a038216600090815260056020526040902054611f7890600163ffffffff6126df16565b600160a060020a03909216600090815260056020908152604080832094909455918152600390915220805473ffffffffffffffffffffffffffffffffffffffff19169055565b600081815260036020526040902054600160a060020a031615611fe057600080fd5b6000818152600360209081526040808320805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0387169081179091558352600590915290205461202f9060016126f1565b600160a060020a0390921660009081526005602052604090209190915550565b60006120596127df565b50506040805160608101825263ffffffff94851681526fffffffffffffffffffffffffffffffff93841660208201908152600160a060020a03938416928201928352600780546001808201835560009290925292517fa66cc928b5edb82af9bd49922954155ab7b0942694bea4ce44661d9a8736c688600285029081018054945163ffffffff19909516928a16929092177fffffffffffffffffffffffff00000000000000000000000000000000ffffffff166401000000009489169490940293909317905592517fa66cc928b5edb82af9bd49922954155ab7b0942694bea4ce44661d9a8736c689909101805473ffffffffffffffffffffffffffffffffffffffff19169190941617909255600980546fffffffffffffffffffffffffffffffff198116908516909201909316179091551690565b60006121996127df565b50604080516060810182526007805463ffffffff8082168085526000602086018181529686018181526001850186559490528451600284027fa66cc928b5edb82af9bd49922954155ab7b0942694bea4ce44661d9a8736c6888101805498516fffffffffffffffffffffffffffffffff16640100000000027fffffffffffffffffffffffff00000000000000000000000000000000ffffffff9390951663ffffffff1990991698909817919091169290921790955591517fa66cc928b5edb82af9bd49922954155ab7b0942694bea4ce44661d9a8736c6899092018054600160a060020a039390931673ffffffffffffffffffffffffffffffffffffffff199093169290921790915590916122af9033906126fe565b63ffffffff81166000908152600a6020908152604090912088516122d5928a0190612761565b5063ffffffff81166000908152600c60209081526040808320805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a038a16179055600d825280832080546fffffffffffffffffffffffffffffffff19166fffffffffffffffffffffffffffffffff8b16179055600b8252909120855161235b92870190612761565b5063ffffffff169695505050505050565b60008061238185600160a060020a0316612759565b151561239057600191506124e8565b6040517f150b7a020000000000000000000000000000000000000000000000000000000081523360048201818152600160a060020a03898116602485015260448401889052608060648501908152875160848601528751918a169463150b7a0294938c938b938b93909160a490910190602085019080838360005b8381101561242357818101518382015260200161240b565b50505050905090810190601f1680156124505780820380516001836020036101000a031916815260200191505b5095505050505050602060405180830381600087803b15801561247257600080fd5b505af1158015612486573d6000803e3d6000fd5b505050506040513d602081101561249c57600080fd5b50517fffffffff0000000000000000000000000000000000000000000000000000000081167f150b7a020000000000000000000000000000000000000000000000000000000014925090505b50949350505050565b600160a060020a038116151561250657600080fd5b60008054604051600160a060020a03808516939216917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a36000805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055565b60006125786127df565b506040805160608101825263ffffffff80871682526fffffffffffffffffffffffffffffffff80871660208401908152600160a060020a03808816958501958652600780546001810182556000919091528551600282027fa66cc928b5edb82af9bd49922954155ab7b0942694bea4ce44661d9a8736c688810180549551909616640100000000027fffffffffffffffffffffffff00000000000000000000000000000000ffffffff92881663ffffffff1990961695909517919091169390931790935594517fa66cc928b5edb82af9bd49922954155ab7b0942694bea4ce44661d9a8736c68990910180549190951673ffffffffffffffffffffffffffffffffffffffff199091161790935590919061269590859083166126fe565b6008805460017001000000000000000000000000000000008083046fffffffffffffffffffffffffffffffff90811692909201821602911617905563ffffffff1695945050505050565b6000828211156126eb57fe5b50900390565b818101828110156110fc57fe5b600160a060020a038216151561271357600080fd5b61271d8282611fbe565b6040518190600160a060020a038416906000907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef908290a45050565b6000903b1190565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106127a257805160ff19168380011785556127cf565b828001600101855582156127cf579182015b828111156127cf5782518255916020019190600101906127b4565b506127db9291506127ff565b5090565b604080516060810182526000808252602082018190529181019190915290565b61281991905b808211156127db5760008155600101612805565b905600a165627a7a7230582063103d2366713eb2e0fca9da3427bf73fb16f3ff3e7fc8d62685b148a529a2490029"}))
      })
      it('Cost for creating a donation', async() => {
        let receipt = await notary.createDonation(`Campaign-2`, 10e18, charity, taxId);
        receipt = await web3.eth.getTransactionReceipt(receipt.tx);
        console.log(receipt.gasUsed)
      })
      it('Cost for making a donation', async() => {
        let receipt = await notary.makeDonation(1, { value: 10e18, from: creator });

        receipt = await web3.eth.getTransactionReceipt(receipt.tx);
        console.log(receipt.gasUsed)
      })
      it('Cost for issuing a donation', async() => {
        let receipt = await notary.issueDonation(1, 1000, zeroAddress);

        receipt = await web3.eth.getTransactionReceipt(receipt.tx);
        console.log(receipt.gasUsed)
      })
    })
  })
})

